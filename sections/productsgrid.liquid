{{ 'product-grid-gw.css' | asset_url | stylesheet_tag }}



<div id="cart-list" class="card_product-container">
  {% for product in collections.all.products %}
      <script> console.log({{ product | json }})</script>
       <div class="card">
          <div class="card_product-header">
              <h2>{{ product.title }}</h2>
          </div>
          <div class="card_product-body">
              <img srcset="//cdn.shopify.com/s/files/1/0597/0044/5384/{{product.featured_image}}"  alt="" id="image{{product.id}}">
          </div>

          <div class="card_product-description">
              <h3> Descripci√≥n</h3>
              <span>{{ product.description }}</span>
          </div>

          <div class="card_product-option">

              
              {% if product.has_only_default_variant %}
        
                <input name="id" value="{{ variant.id }}" type="hidden">
            
                {% else %}
              
                  {% for option in product.options_with_values %}
                    
                      {% if option.name == "Talla" %}
                      
                        <div class="card_option-Select">
                            <select name="talla" 
                              class="selectSelected"     
                              onchange="changeOption(event)" 
                            >
                            {% for value in option.values %}
                              <option 
                                value="{{ value }}">
                                  {{value}}
                              </option>
                            {% endfor%}
                          </select>
                        </div>
                        
                      {% endif %}
              
            
              
                    {% if option.name == "Color" %}
                      <!-- <label >{{ option.name }}</label> -->
                      <div class="card_option-radio">
                        {% for value in option.values %}
                            
                              <input 
                              id="color-{{ forloop.index }}"  
                              class="radioSelect"    
                              type="radio" 
                              name="color{{product.id}}" 
                              value="{{ value }}"
                              onmouseover="changeOption(event)"
                              
                               
                              {%if forloop.first%}  
                                checked
                              {%endif%} 
                            />
                          
                            {{value}}
                            
                        {% endfor%}
                      </div>
                      
                    {% endif %}
              
                    
                  {% endfor%}
            
              {% endif %}
          
          </div>

          <div class="card_product-add">
            <button type="button" name="bntAdd" class="add-cart"  data-id="{{product.id}}" onclick="addProduct(event)" >Add</button>
          </div>
       
        </div>
  {%endfor%}      
</div>


<script>

  

  const arrCollection = {{collections.all.products | json}}


  function changeOption(e){
    const productCard = e.target.parentElement.parentElement.parentElement;
    console.log(productCard.querySelector('input'));
     e.target.checked = true;
     const {id_product , varianObj} = readDateCard(productCard);
     const  imageObj  =  varianObj.featured_image.src;
     console.log(varianObj);

     const image = document.querySelector(`#image${id_product}`);
           image.setAttribute('srcset', imageObj);
  } 
  
  
  function addProduct(e){
    e.preventDefault();
    if(e.target.classList.contains('add-cart')){
        //buscamos todo lo q tiene donde se hizo clic  
        const productCard = e.target.parentElement.parentElement;
        const {varianObj} = readDateCard(productCard);
        
        addCarrito(varianObj.id);

    }
  }
  
  //sacamos los datos del segmentos en objeto
  function readDateCard(productCard){
   
        let id_product = Number(productCard.querySelector('button').getAttribute('data-id'));
        let option1 = productCard.querySelector("select").value;
        let option2 = productCard.querySelector(`input[name='color${id_product}']:checked`).value;
        //obtener id de la variacion 
        let compareVariantOption = `${option1} / ${option2}`;

        //Buscar variantes de producto
        const [arrProduct] = findVariantProduct(id_product);
        
        const varianObj = findIdVariant(arrProduct.variants, compareVariantOption);

        return {varianObj, id_product};
  
  }

  function findVariantProduct(id_product){
    
      const arrProduct = arrCollection.filter(product => {
          
          if(product.id === id_product){
            return product;
          }
      })
      return arrProduct;
  }

  function findIdVariant(variantsProductArr, compareVariantOption){

    let variantArr;
     variantsProductArr.filter(variant => {
       if(variant.title === compareVariantOption){
          variantArr = variant;
       }
     });

     return variantArr;
  }
  
  
  //agregando al carrito
  function addCarrito(id_variant){
    

    let formData = {
        'items': [{
          'id': id_variant,
          'quantity': 1
          }]
        };

        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        })
        .then(response => {

          loadCart();
          showCart();
          return response.json();

          console.log("add");
        })
        .catch((error) => {
          console.error('Error:', error);
        });

   
  }
  
  </script>
	


  {% schema %}
  {
    //"name": "product grid",
      //"settings": [{}]
  }
  {% endschema %}